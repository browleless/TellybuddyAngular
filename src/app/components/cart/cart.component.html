<div style="padding: 0 17.5% 0 17.5%; margin-top: 3%;">
    <div *ngIf="!loaded">
        <mat-spinner style="margin: 0 auto;"></mat-spinner>
    </div>
    <div
        *ngIf="loaded && !sessionService.getCart().transactionLineItems.length"
    >
        <div style="text-align: center;">
            <h1>Your Cart is Empty!</h1>
            <img
                style="max-width: 100%; height: 400px; object-fit: cover;"
                src="https://cdn.dribbble.com/users/44167/screenshots/4199208/empty-cart-rappi.png"
            />
            <p>
                Add some shit now
            </p>
        </div>
    </div>
    <div *ngIf="loaded && sessionService.getCart().transactionLineItems.length">
        <div style="text-align: center;">
            <h1>Your Cart</h1>
            <p style="margin-bottom: 30px;">
                Review your cart and checkout now!
            </p>
        </div>
        <table
            mat-table
            [dataSource]="transaction.transactionLineItems"
            style="width: 100%;"
            class="mat-elevation-z8"
        >
            <ng-container matColumnDef="item">
                <th mat-header-cell *matHeaderCellDef>
                    Item
                </th>
                <td mat-cell *matCellDef="let transactionLineItem">
                    <span *ngIf="transactionLineItem.subscription">
                        {{ transactionLineItem.subscription.plan.name }}
                    </span>
                    <span *ngIf="transactionLineItem.product">
                        {{ transactionLineItem.product.name }}
                    </span>
                </td>
            </ng-container>

            <ng-container matColumnDef="price">
                <th
                    style="text-align: center;"
                    mat-header-cell
                    *matHeaderCellDef
                >
                    Price
                </th>
                <td
                    style="text-align: center;"
                    mat-cell
                    *matCellDef="let transactionLineItem"
                >
                    {{ transactionLineItem.price | currency }}
                </td>
            </ng-container>

            <ng-container matColumnDef="quantity">
                <th
                    style="text-align: center;"
                    mat-header-cell
                    *matHeaderCellDef
                >
                    Quantity
                </th>
                <td
                    style="text-align: center;"
                    mat-cell
                    *matCellDef="let transactionLineItem; let i = index"
                >
                    <mat-form-field
                        style="width: 150px; margin-bottom: -1.25em;"
                        appearance="outline"
                    >
                        <input
                            matInput
                            style="text-align: center;"
                            min="1"
                            [disabled]="transactionLineItem.subscription"
                            oninput="validity.valid||(value='1')"
                            type="number"
                            [(ngModel)]="
                                transaction.transactionLineItems[i].quantity
                            "
                            (change)="updateLineItemQuantity(i)"
                        />
                        <mat-icon
                            *ngIf="transactionLineItem.product"
                            style="cursor: pointer;"
                            matPrefix
                            (click)="decrementLineItemQuantity(i)"
                            >remove</mat-icon
                        >
                        <mat-icon
                            *ngIf="transactionLineItem.product"
                            style="cursor: pointer;"
                            matSuffix
                            (click)="incrementLineItemQuantity(i)"
                            >add</mat-icon
                        >
                    </mat-form-field>
                </td>
            </ng-container>

            <ng-container matColumnDef="subtotal">
                <th
                    style="text-align: center;"
                    mat-header-cell
                    *matHeaderCellDef
                >
                    Sub Total
                </th>
                <td
                    style="text-align: center;"
                    mat-cell
                    *matCellDef="let transactionLineItem"
                >
                    {{
                        transactionLineItem.price *
                            transactionLineItem.quantity | currency
                    }}
                </td>
            </ng-container>

            <ng-container matColumnDef="action">
                <th
                    style="text-align: right;"
                    mat-header-cell
                    *matHeaderCellDef
                >
                    <button mat-button (click)="clearCart()">Clear All</button>
                </th>
                <td
                    style="text-align: right;"
                    mat-cell
                    *matCellDef="let transactionLineItem; let i = index"
                >
                    <button
                        style="
                            border-radius: 50%;
                            min-width: 0;
                            padding: 0 6px 0 6px;
                        "
                        mat-button
                        (click)="deleteLineItem(i)"
                    >
                        <mat-icon>close</mat-icon>
                    </button>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>

        <div style="margin-top: 50px; width: fit-content; float: right;">
            <mat-card style="border-radius: 0;" class="mat-elevation-z8">
                Total:
                <span style="font-size: large; font-weight: bold;">
                    {{ getTotalCost() | currency }}
                </span>
            </mat-card>
        </div>
    </div>
</div>
